{"ast":null,"code":"import{jsxs as _jsxs}from\"react/jsx-runtime\";import{jsx as _jsx}from\"react/jsx-runtime\";import _regeneratorRuntime from\"C:/Users/HO_CHUN_WEI/Desktop/web/Jose-Antonio_LoverBus/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/HO_CHUN_WEI/Desktop/web/Jose-Antonio_LoverBus/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _slicedToArray from\"C:/Users/HO_CHUN_WEI/Desktop/web/Jose-Antonio_LoverBus/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from\"react\";import{useQuery,useMutation}from'@apollo/react-hooks';import'antd/dist/antd.css';import{Input,Layout,Menu,Breadcrumb,Button,Card,Select}from'antd';import{TagOutlined,CheckOutlined}from'@ant-design/icons';import SweetAlert from\"react-bootstrap-sweetalert\";import usePlan from'../components/usePlan';import mapboxgl from\"mapbox-gl\";import{// for query\n// MARKER_QUERY,\n// for mutation\nADD_MARKER_MUTATION,DELETE_MARKER_MUTATION,UPDATE_MARKER_MUTATION,NEWSPOT_MUTATION,NEWPLAN_MUTATION// for subscription\n}from'../graphql';var Header=Layout.Header,Content=Layout.Content,Footer=Layout.Footer,Sider=Layout.Sider;var AddPlace=function AddPlace(_ref){var username=_ref.username,currentMarker=_ref.currentMarker,setCurrentMarker=_ref.setCurrentMarker,markerContentCallback=_ref.markerContentCallback,insertionMode=_ref.insertionMode,plan=_ref.plan,title=_ref.title,setTitle=_ref.setTitle,description=_ref.description,setDescription=_ref.setDescription;var setCurrentMarkerContent=function setCurrentMarkerContent(e){markerContentCallback(e);};var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),planId=_useState2[0],setPlanId=_useState2[1];var _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),list1Value=_useState4[0],setList1Value=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),showList1=_useState6[0],setshowList1=_useState6[1];var _useMutation=useMutation(NEWSPOT_MUTATION),_useMutation2=_slicedToArray(_useMutation,1),addSpot=_useMutation2[0];var _useMutation3=useMutation(DELETE_MARKER_MUTATION),_useMutation4=_slicedToArray(_useMutation3,1),deleteMarker=_useMutation4[0];var _useMutation5=useMutation(UPDATE_MARKER_MUTATION),_useMutation6=_slicedToArray(_useMutation5,1),updateMarker=_useMutation6[0];var _useMutation7=useMutation(ADD_MARKER_MUTATION),_useMutation8=_slicedToArray(_useMutation7,1),addMarker=_useMutation8[0];var deleteOnclick=function deleteOnclick(){var marker_id=currentMarker._id;deleteMarker({variables:{_id:marker_id}});currentMarker.remove();setCurrentMarker(null);};var onclick=/*#__PURE__*/function(){var _ref2=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var CustomTitle,CustomDescription,_currentMarker$_lngLa,lng,lat,marker_id,popup;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:if(currentMarker){_context.next=3;break;}alert(\"select a marker to add\");return _context.abrupt(\"return\");case 3:if(title===\"\"){// alert(\"Please input a title\")\n// return\nsetTitle(\"Untitled\");}if(description===\"\"){setDescription(\"No description\");}CustomTitle=title===\"\"?\"Untitled\":title;CustomDescription=description===\"\"?\"No description\":description;_currentMarker$_lngLa=currentMarker._lngLat,lng=_currentMarker$_lngLa.lng,lat=_currentMarker$_lngLa.lat;marker_id=currentMarker._id;if(!currentMarker.geocoderResult){_context.next=17;break;}_context.next=12;return addMarker({variables:{username:username,title:CustomTitle,coordinates:[currentMarker._lngLat.lng,currentMarker._lngLat.lat],description:CustomDescription}});case 12:marker_id=_context.sent;currentMarker.geocoderResult=null;marker_id=marker_id.data.addMarker;_context.next=26;break;case 17:if(!insertionMode){_context.next=24;break;}_context.next=20;return addMarker({variables:{username:username,title:CustomTitle,coordinates:[lng,lat],description:CustomDescription}});case 20:marker_id=_context.sent;marker_id=marker_id.data.addMarker;_context.next=26;break;case 24:updateMarker({variables:{_id:marker_id,newTitle:CustomTitle,newDescription:CustomDescription}});if(currentMarker.getPopup())currentMarker.getPopup().setHTML(\"<h3>\".concat(CustomTitle,\"<h3><p>\").concat(CustomDescription,\"</p>\"));else{popup=new mapboxgl.Popup().setHTML(\"<h3>\".concat(CustomTitle,\"<h3><p>\").concat(CustomDescription,\"</p>\"));currentMarker.setPopup(popup);}case 26:if(marker_id!==\"\"&&planId!==\"\"){addSpot({variables:{planID:planId,markerID:marker_id}});}case 27:case\"end\":return _context.stop();}}},_callee);}));return function onclick(){return _ref2.apply(this,arguments);};}();var TextArea=Input.TextArea;return/*#__PURE__*/_jsxs(Card,{title:\"Add New Marker\",children:[/*#__PURE__*/_jsx(Card,{type:\"inner\",title:\"Title\",children:/*#__PURE__*/_jsx(Input,{placeholder:\"set your plan title\",allowClear:true,onChange:function onChange(e){setTitle(e.target.value);},value:title})}),/*#__PURE__*/_jsx(Card,{style:{marginTop:16},type:\"inner\",title:\"Descriptions\",children:/*#__PURE__*/_jsx(TextArea,{TextArea:true,rows:4,placeholder:\"set your plan descriptions\",allowClear:true,value:description,onChange:function onChange(e){setDescription(e.target.value);}})}),/*#__PURE__*/_jsx(Card,{style:{marginTop:16},type:\"inner\",title:\"My Plan List\",children:/*#__PURE__*/_jsx(AddtoPlan,{plan:plan,list1Value:list1Value,setList1Value:setList1Value,showList1:showList1,setshowList1:setshowList1,username:username,planId:planId,setPlanId:setPlanId})}),/*#__PURE__*/_jsx(\"br\",{}),insertionMode||!currentMarker?null:/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Button,{size:\"small\",onClick:deleteOnclick,style:{position:\"absolute\",right:\"90px\",bottom:\"10px\"},children:\"Delete\"})}),/*#__PURE__*/_jsx(\"div\",{children:/*#__PURE__*/_jsx(Button,{size:\"small\",onClick:onclick,style:{position:\"absolute\",right:\"25px\",bottom:\"10px\"},children:\"Save\"})})]});};var NEW_ITEM=\"NEW_ITEM\";var Option=Select.Option;var AddtoPlan=function AddtoPlan(_ref3){var username=_ref3.username,plan=_ref3.plan,list1Value=_ref3.list1Value,setList1Value=_ref3.setList1Value,showList1=_ref3.showList1,setshowList1=_ref3.setshowList1,planId=_ref3.planId,setPlanId=_ref3.setPlanId;var list1Options=plan.map(function(e){return e.title;});var _useMutation9=useMutation(NEWPLAN_MUTATION),_useMutation10=_slicedToArray(_useMutation9,1),newPlan=_useMutation10[0];var setDisplayValue=function setDisplayValue(v){setList1Value(v);var _id=plan.filter(function(e){return e.title===v;})[0]._id;setPlanId(_id);};var onChangeList1=function onChangeList1(value){if(value!==NEW_ITEM){setDisplayValue(value);}else{setshowList1(true);}};var onConfirm=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(inputValue){var _id;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:inputValue=inputValue.trim();if(!list1Options.includes(inputValue)){_context2.next=6;break;}setshowList1(false);setDisplayValue(inputValue);_context2.next=12;break;case 6:setshowList1(false);_context2.next=9;return newPlan({variables:{username:username,title:inputValue}});case 9:_id=_context2.sent;setPlanId(_id.data.newPlan);setList1Value(inputValue);case 12:case\"end\":return _context2.stop();}}},_callee2);}));return function onConfirm(_x){return _ref4.apply(this,arguments);};}();var list1SelectOptions=list1Options.map(function(o){return/*#__PURE__*/_jsx(Option,{children:o},o);});return/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(Select,{value:list1Value,style:{width:100},onChange:onChangeList1,children:[list1SelectOptions,/*#__PURE__*/_jsx(Option,{value:NEW_ITEM,children:\"+ New Plan\"})]}),/*#__PURE__*/_jsx(SweetAlert,{show:showList1,title:\"Add New Plan\",text:\"Enter new Plan Name\",showCancelButton:true,type:\"input\",inputPlaceholder:\"Enter Plan Name\",animation:\"slide-from-top\",validationMsg:\"Please enter a name!\",onConfirm:onConfirm,onCancel:function onCancel(){setshowList1(false);},onEscapeKey:function onEscapeKey(){setshowList1(false);},onOutsideClick:function onOutsideClick(){setshowList1(false);}})]});};export default AddPlace;","map":{"version":3,"sources":["C:/Users/HO_CHUN_WEI/Desktop/web/Jose-Antonio_LoverBus/src/components/AddPlace.js"],"names":["React","useEffect","useRef","useState","useQuery","useMutation","Input","Layout","Menu","Breadcrumb","Button","Card","Select","TagOutlined","CheckOutlined","SweetAlert","usePlan","mapboxgl","ADD_MARKER_MUTATION","DELETE_MARKER_MUTATION","UPDATE_MARKER_MUTATION","NEWSPOT_MUTATION","NEWPLAN_MUTATION","Header","Content","Footer","Sider","AddPlace","username","currentMarker","setCurrentMarker","markerContentCallback","insertionMode","plan","title","setTitle","description","setDescription","setCurrentMarkerContent","e","planId","setPlanId","list1Value","setList1Value","showList1","setshowList1","addSpot","deleteMarker","updateMarker","addMarker","deleteOnclick","marker_id","_id","variables","remove","onclick","alert","CustomTitle","CustomDescription","_lngLat","lng","lat","geocoderResult","coordinates","data","newTitle","newDescription","getPopup","setHTML","popup","Popup","setPopup","planID","markerID","TextArea","target","value","marginTop","position","right","bottom","NEW_ITEM","Option","AddtoPlan","list1Options","map","newPlan","setDisplayValue","v","filter","onChangeList1","onConfirm","inputValue","trim","includes","list1SelectOptions","o","width"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport { useQuery, useMutation } from '@apollo/react-hooks'\r\nimport 'antd/dist/antd.css'\r\nimport { Input, Layout, Menu, Breadcrumb, Button, Card, Select } from 'antd';\r\nimport { TagOutlined, CheckOutlined} from '@ant-design/icons';\r\nimport SweetAlert from \"react-bootstrap-sweetalert\";\r\nimport usePlan from '../components/usePlan'\r\nimport mapboxgl from \"mapbox-gl\";\r\n\r\nimport {\r\n// for query\r\n// MARKER_QUERY,\r\n// for mutation\r\nADD_MARKER_MUTATION,\r\nDELETE_MARKER_MUTATION,\r\nUPDATE_MARKER_MUTATION,\r\nNEWSPOT_MUTATION,\r\nNEWPLAN_MUTATION,\r\n// for subscription\r\n} from '../graphql'\r\n\r\nconst { Header, Content, Footer, Sider } = Layout;\r\n\r\nconst AddPlace = ({username, currentMarker, setCurrentMarker, markerContentCallback, insertionMode, plan, title, setTitle, description, setDescription}) => {\r\n  const setCurrentMarkerContent = e => { markerContentCallback(e);} \r\n  const [planId, setPlanId] = useState(\"\")\r\n  const [list1Value, setList1Value] = useState(\"\")\r\n  const [showList1, setshowList1] = useState(false)\r\n  const [addSpot] = useMutation(NEWSPOT_MUTATION)\r\n  const [deleteMarker] = useMutation(DELETE_MARKER_MUTATION)\r\n  const [updateMarker] = useMutation(UPDATE_MARKER_MUTATION)\r\n  const [addMarker] = useMutation(ADD_MARKER_MUTATION)\r\n  const deleteOnclick = () => {\r\n    const marker_id = currentMarker._id\r\n    deleteMarker({variables:{_id:marker_id}})\r\n    currentMarker.remove()\r\n    setCurrentMarker(null)\r\n  }\r\n  const onclick = async () => {\r\n    if(!currentMarker) {\r\n      alert(\"select a marker to add\")\r\n      return\r\n    }\r\n    if(title === \"\"){\r\n      // alert(\"Please input a title\")\r\n      // return\r\n      setTitle(\"Untitled\")\r\n    }\r\n    if(description === \"\"){\r\n      setDescription(\"No description\")\r\n    }\r\n    const CustomTitle = title === \"\" ? \"Untitled\" : title\r\n    const CustomDescription = description === \"\" ? \"No description\" : description\r\n    const {lng, lat} = currentMarker._lngLat\r\n    var marker_id = currentMarker._id\r\n    if(currentMarker.geocoderResult){\r\n      marker_id = await addMarker({variables:{\r\n        username: username,\r\n        title: CustomTitle,\r\n        coordinates: [currentMarker._lngLat.lng, currentMarker._lngLat.lat],\r\n        description: CustomDescription\r\n      }})\r\n      currentMarker.geocoderResult = null\r\n      marker_id = marker_id.data.addMarker\r\n    }\r\n    else if(insertionMode){\r\n      marker_id = await addMarker({variables:{\r\n        username: username,\r\n        title: CustomTitle,\r\n        coordinates: [lng, lat],\r\n        description: CustomDescription\r\n      }})\r\n      marker_id = marker_id.data.addMarker\r\n    }\r\n    else{\r\n      updateMarker({variables:{\r\n        _id:marker_id,\r\n        newTitle: CustomTitle,\r\n        newDescription: CustomDescription\r\n      }})\r\n      if(currentMarker.getPopup())\r\n        currentMarker.getPopup().setHTML(`<h3>${CustomTitle}<h3><p>${CustomDescription}</p>`);\r\n      else{\r\n        var popup = new mapboxgl.Popup()\r\n            .setHTML(`<h3>${CustomTitle}<h3><p>${CustomDescription}</p>`);\r\n        currentMarker.setPopup(popup)\r\n      }\r\n    }\r\n    if(marker_id !== \"\" && planId !== \"\"){\r\n      addSpot({variables:{\r\n        planID: planId,\r\n        markerID: marker_id\r\n      }})\r\n    }\r\n  }\r\n  const { TextArea } = Input;\r\n  return (\r\n    <Card title=\"Add New Marker\">\r\n      <Card type=\"inner\" title=\"Title\">\r\n        <Input placeholder=\"set your plan title\" allowClear\r\n              onChange={(e) => {setTitle(e.target.value)}}\r\n              value={title} ></Input>\r\n      </Card>\r\n      <Card\r\n        style={{ marginTop: 16 }}\r\n        type=\"inner\"\r\n        title=\"Descriptions\"\r\n      >\r\n        <TextArea TextArea rows={4} placeholder=\"set your plan descriptions\" allowClear\r\n                  value={description}\r\n                  onChange={(e) => {setDescription(e.target.value)}}></TextArea> \r\n      </Card>\r\n      <Card  \r\n        style={{ marginTop: 16 }}\r\n        type=\"inner\"\r\n        title=\"My Plan List\">\r\n        <AddtoPlan plan={plan} list1Value={list1Value} setList1Value={setList1Value}\r\n                showList1={showList1} setshowList1={setshowList1} username={username}\r\n                planId={planId} setPlanId={setPlanId}></AddtoPlan>\r\n      </Card>\r\n      <br></br>\r\n      {insertionMode || !currentMarker ? null : (\r\n      <div>\r\n        <Button size={\"small\"} onClick={deleteOnclick} style={{position: \"absolute\", right: \"90px\", bottom: \"10px\"}}>Delete</Button>\r\n      </div>)}\r\n      <div>\r\n        <Button size={\"small\"} onClick={onclick} style={{position: \"absolute\", right: \"25px\", bottom: \"10px\"}}>Save</Button>\r\n      </div>\r\n    </Card>\r\n  )\r\n}\r\n\r\nconst NEW_ITEM = \"NEW_ITEM\";\r\nconst Option = Select.Option;\r\n\r\nconst AddtoPlan = ({username, plan, list1Value, setList1Value, showList1, setshowList1, planId, setPlanId}) => {\r\n  const list1Options = plan.map(e=>e.title)\r\n  const [newPlan] = useMutation(NEWPLAN_MUTATION)\r\n  const setDisplayValue = (v) => {\r\n    setList1Value(v);\r\n    const _id = plan.filter(e=>e.title === v)[0]._id\r\n    setPlanId(_id)\r\n  }\r\n  const onChangeList1 = (value) => {\r\n    if (value !== NEW_ITEM) {\r\n      setDisplayValue(value)\r\n    } else {\r\n      setshowList1(true)\r\n    }\r\n  };\r\n\r\n  const onConfirm = async (inputValue) => {\r\n    inputValue = inputValue.trim();\r\n    if (list1Options.includes(inputValue)) {\r\n      setshowList1(false)\r\n      setDisplayValue(inputValue)\r\n    } else {\r\n      setshowList1(false)\r\n      const _id = await newPlan({variables:{username:username,title:inputValue}})\r\n      setPlanId(_id.data.newPlan)\r\n      setList1Value(inputValue)\r\n    }\r\n  };\r\n\r\n  const list1SelectOptions = list1Options.map(o => (\r\n    <Option key={o}>{o}</Option>\r\n  ));\r\n\r\n    return (\r\n      <div>\r\n        <Select\r\n          value={list1Value}\r\n          style={{ width: 100 }}\r\n          onChange={onChangeList1}\r\n        >\r\n          {list1SelectOptions}\r\n          <Option value={NEW_ITEM}>+ New Plan</Option>\r\n        </Select>\r\n\r\n        <SweetAlert\r\n          show={showList1}\r\n          title=\"Add New Plan\"\r\n          text=\"Enter new Plan Name\"\r\n          showCancelButton\r\n          type=\"input\"\r\n          inputPlaceholder=\"Enter Plan Name\"\r\n          animation=\"slide-from-top\"\r\n          validationMsg=\"Please enter a name!\"\r\n          onConfirm={onConfirm}\r\n          onCancel={() => {\r\n            setshowList1(false);\r\n          }}\r\n          onEscapeKey={() => {setshowList1(false)}}\r\n          onOutsideClick={() => {setshowList1(false)}}\r\n        />\r\n      </div>\r\n    );\r\n  }\r\n\r\nexport default AddPlace\r\n"]},"metadata":{},"sourceType":"module"}